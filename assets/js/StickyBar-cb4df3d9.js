import{_ as j,o as V,l as O}from"./index-c269a5b9.js";import{d as P}from"./pinia-692ce71d.js";import{i as T,d as q,r as k,q as h,S as J,z as R,n as Z,o as A,y as D,H as F,I as G,J as L,L as Q,M as K,K as g}from"./@vue-dca935c3.js";const W=P("uiSticky",{state:()=>({items:[],count:1}),actions:{add(i=0){const n=this.count;return this.items.push({key:n,height:i}),this.count++,n},remove(i){const n=this.items.findIndex(e=>e.key===i);this.items.splice(n,1)},update(i,n=0){const e=this.items.findIndex(t=>t.key===i);this.items[e].height!==n&&(this.items[e].height=n)}}}),b=()=>({wrap:"",contents:"",fake:""}),X={props:{classNames:{Type:Object,default(){return b()}}},setup(i){const n=T("uiLayer",{}),e=T("popupLayout",{}),t={ui:{scrollBlock:V(),header:O(),sticky:W()}},s=q({isSticky:!1,marginTop:"0",marginBottom:"0",height:"0",storeKey:null}),d=k(null),y=k(null),x=k(null),N=h(()=>{const{classNames:o}=i;return Object.assign(b(),o)}),v=h(()=>{const o=e&&e.head&&e.head.value;return(()=>o?o.offsetHeight:0)()||t.ui.header.height}),C=h(()=>S()),S=()=>{const{items:o}=t.ui.sticky;let c=0;if(s.storeKey)for(let r=0;r<o.length&&o[r].key!==s.storeKey;r++)c+=o[r].height;return c},_=()=>{const c=y.value.children[0],r=getComputedStyle(c),m=r.getPropertyValue("margin-top"),a=r.getPropertyValue("margin-bottom");s.marginTop=m,s.marginBottom=a},l=()=>{const o=d.value;if(o.offsetHeight<=0)return;const c=document.getElementsByTagName("html")[0],m=y.value.children[0],a=e&&e.body&&e.body.value,E=v.value,H=c.scrollTop,p=(()=>a?a.scrollTop+E:t.ui.scrollBlock.isBlocking?t.ui.scrollBlock.scrollTop:H)(),M=(a?p+H:p)+o.getBoundingClientRect().top,U=S(),f=m.offsetHeight;if(a?s.storeKey&&(t.ui.sticky.remove(s.storeKey),s.storeKey=null):s.storeKey?t.ui.sticky.update(s.storeKey,f):s.storeKey=t.ui.sticky.add(f),p<=M-E-U){s.isSticky&&(s.isSticky=!1);return}s.height=`${f}px`,s.isSticky||(s.isSticky=!0)},u=()=>{l()},B=()=>{l()},w=()=>{l()},z=()=>{const o=e&&e.body&&e.body.value;o&&o.addEventListener("scroll",u)},I=()=>d.value;return J(()=>{n&&n.stickyBar&&(n.stickyBar.value={update:l},e.stickyBar.value={scrollBind:z})}),R(()=>{_(),Z(()=>{l()}),window.addEventListener("load",w),window.addEventListener("scroll",u),window.addEventListener("resize",B)}),A(()=>{s.storeKey&&t.ui.sticky.remove(s.storeKey),window.removeEventListener("load",w),window.removeEventListener("scroll",u),window.removeEventListener("resize",B);const o=e&&e.body&&e.body.value;o&&o.removeEventListener("scroll",u)}),D("stickyBar",{getElement:I}),{state:s,wrap:d,contents:y,fake:x,customClassNames:N,headerH:v,stickyH:C}}};function Y(i,n,e,t,s,d){return F(),G("div",{ref:"wrap",class:g(t.customClassNames.wrap)},[L("div",{ref:"contents",style:K({position:t.state.isSticky?"fixed":"static",top:t.state.isSticky?`${t.headerH+t.stickyH}px`:null,left:t.state.isSticky?"0":null,width:t.state.isSticky?"100%":null,zIndex:t.state.isSticky?"1000":null,transform:"translateZ(0)",transition:"transform 0s"}),class:g([{"is-sticky":t.state.isSticky},t.customClassNames.contents])},[Q(i.$slots,"default",{isSticky:t.state.isSticky})],6),L("div",{class:g(t.customClassNames.fake),style:K({display:t.state.isSticky?"block":"none",marginTop:t.state.marginTop,marginBottom:t.state.marginBottom,height:t.state.height})},null,6)],2)}const st=j(X,[["render",Y]]);export{st as S};
